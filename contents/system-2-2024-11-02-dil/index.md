---
date: '2024-11-02'
title: "대규모 시스템 설계 기초 2 - DIL (4)"
categories: [ 'study', "DIL" ]
summary: "상세설계"
thumbnail: '../common.png'
---
# 상세 설계

## 지리 정보 테이블 구조 설계

1. Hash 와 business_ids

| geo hash | business_ids  |
|----------|---------------|
| 32feac   | 343, 123,     |
| f3lcad   | 456, 789, 111 |

2. Hash 와 business_id

| geo hash | business_id |
|----------|-------------|
| 32feac   | 343         |
| 32feac   | 123         |
| f3lcad   | 456         |
| f3lcad   | 789         |
| f3lcad   | 111         |

전자 보다 후자가 나은 이유

1. 생성 및 업데이트 비용이 적음.
2. 병렬적으로 갱신이 발생한다면 락을 고려해야해서 성능 저하가 발생할 수 있음.

## 지리 정보 색인 규모 확장

1. 샤딩을 진행하려면 실제 저장되는 데이터의 양을 고려해야함.
2. 지리 정보 색인은 전부 저장한다고해도 1.71G 밖에 안됨.
3. 이 경우 Read 데이터베이스를 늘리는게 좋은 판단.

## 캐시

캐시를 적용하려면 일단 캐시가 정말 필요한지 판단해야함.

"데이터 베이스 크기가 상대적으로 작다." -> 질의문은 I/O 에 좌우되지 않고 메모리 캐시와 비슷함.

위의 이유를 일단 기본적으로 생각해야함. 그래도 도입해야 판단이 된다면 비용 분석에 유의.

### 캐시 키


- 사용자의 위도 및 경도 -> 위치 정보는 추정치 이며 같은 자리라고 해도 다른 위도, 경도를 가질 수 있기 때문에 고려대상 X
- 사용자의 위도 및 경도를 기반으로 한 geo hash -> 사용자의 위치를 기반으로 한 캐시 키를 사용하는 것이 좋음.
    - Value 에 해당하는 작업장 정보는 자주 수정되지 않는다.
    - 검색 반경이 500m, 1km, 2km 여러가지가 존재. 모두 캐시적용 해놓아야함.
### 캐시 무효화
- 사업장 정보의 변경이 발생할 때 캐시를 무효화
    - 빈도수가 적기 때문에 락을 고려하지 않아도 됨.


## 지역 및 가용성 구역

- 여러 지역에 나눠서 설치
- 빠른 응답속도와 데이터보안의 이점이 존재.


## 추가질문

1. 현재 영업중인 사업장, 식당 정보만 받아오기 등의 요구사항 처리는 어떻게?
   사용자의 위치에 해당하는 geo hash 를 찾아서 모든 사업장을 가져온다. 해당하는 사업장들의 개수가 적기 때문에
   여기서 필터링하여 반환. 

