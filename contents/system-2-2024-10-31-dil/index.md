---
date: '2024-10-31'
title: "대규모 시스템 설계 기초 2 - DIL (3)"
categories: [ 'study', "DIL" ]
summary: "쿼드트리 및 구글 S2"
thumbnail: '../common.png'
---

# 쿼드 트리

## 메모리 계산

- 데이터베이스에 구축하는게 아니라 메모리 내부에 존재.
- Application Server 가 시작할 때 구축이 되어야 함.
- 사용하는 메모리 크기는 얼마정도 될까?
    - 말단 노드에 포함되어야할 사업장의 갯수는?
    - 말단 노드, 내부 노드 각각의 크기를 우선 계산.
    - 말단 노드, 내부 노드의 수를 계산.
        - 말단 노드의 수 -> 요구사항에 달림. 전체의 값 중에 각 격자 안에 몇개의 값이 포함되어야 하는지?
        - 내부 노드의 수 = 말단 노드의 수 * (1 / 3) [설명](https://www.acmicpc.net/board/view/65494)
    - 말단 노드, 내부 노드의 크기를 곱해서 메모리 크기를 계산.

- 결론 -> 생각보다 많이 잡아먹지 않음.

## 탐색 방법

- 탐색
    - 위도, 경도가 주어짐.
    - 루트 노드부터 각 좌상단, 우하단 좌표를 비교해서 말단 노드까지 내려감.
    - 말단 노드에 충분한 사업장 갯수가 있으면 반환, 그렇지 않다면 인접노드도 추가

## 주의사항

- 서버가 가동될 때 몇분간 트리 구축 시간이 소요됨 -> 한꺼번에 동시 업데이트 시 문제 발생가능성
- 장소가 추가될 때 실시간으로 트리 재구축 하는것이 어려움 ( 캐시무효화, 락 등의 문제 )

# 구글 S2

- 구글 S2 는 지오펜스를 구현할 수 있다.
- 지오펜스는 어떤것?
    - 기본적인 주변 사업장 검색 지원
    - 관심있는 영역을 설정하고 해당 경계를 벗어나면 알림을 주는 게 가능.
        - 배민 기존 지역과 다른 지역에서 어플리케이션을 실행했을 때 다른지역이라고 알림을 주는것?이 될 수 있나?


# 지오해시, 쿼드 트리 차이점

- 개인적으로 사용한다면 지오해시를 사용할 것 같다.
    - 상용 제품들이 많이 나와있음.
    - 레퍼런스가 많음.
    - 상대적으로 쿼드 트리보다 구축이 쉬워보임.
