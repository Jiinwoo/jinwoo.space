{"componentChunkName":"component---src-templates-post-template-tsx","path":"/kotlin-patch-api/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>CRUD API 작성함에 있어 GET, POST, PUT 과 같은 메소드들은 일반적으로 잘 작성하는 듯 하나 PATCH 메소드의 경우 어떻게 작성해야 하는지 감이 안오는 경우가 있습니다.\n이번 기회에 제가 생각하는 기준으로 어떻게 작성해야하는지 정리해보도록 하겠습니다.</p>\n<h1>문제 상황 정의</h1>\n<p>null 로 비즈니스로직을 처리할 수 있는 예시 화면을 가져와 봤습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 695px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4380c0ac78856a1ca85fe4d20a686776/f5f2a/img_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.97916666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVR42m2UybLTMBRE/QFQL45lS/IkeXYSOwn1YMN/sQQ+/dItJeEVxaLLiUs6t+/k5Pf8XbZtk/W0yrfLJtv5LCfqdJJ1XWSe5/9qmiYZx1GWZZF93+V+v8vtdpNkWCZxzokx5h/Zv7Kl2DKqLKuXqiqqruqgpmkkue8n8f0QlGVKMpWLUkVUriU9qqBjXgBcSV4Y0aZEoBJPI03dSGmttG0rFs/kx6dBfpVf5OfnWb7mjWR08riYAXpEAIpwAovcBBhVaAOHNYCltE0rFe4moyqlT7X4NyV5quRwzF6usiwPbgjn5UJbgI3kgFNFoUVrLS2gDk75TA6I/tQrXRwOKh4QXFSKl20IoAGnK9bPosahfpBFCRIVIPGCyj/AAjCKDpUy0jk0AU4IZAO6rhPL34CFGhJ4RFqHQypvh0ze0phqytTTLATQcFIUNkqXsZbPSUC6hNToeF3DJZSM44RZWmUYRkTsMUIe0Vup4aDCgRq/NdLKAVx0LZOyoZ4EElYGWanQsArBkzOGeNv2MKAc1J4j5H1IgcARafmqFVPWSLmX3uE/3tERHVaEPdTAKYAXuWBD6K7v+4dLF1yy6NyIznfStE6u1xu2JAYehxjY4T2DO8hDCWFcmcvlElaKUP8AWLiYUYoBzurGhUx4hkAGGgDleRqgPJRwj6/XK/Z2lQWacGHgBQB2P8iOneb6dSjF+/t73HucW1F3wvpHRv4JZMpcbn4MCOoRleNA+xxW1tahbq71ITCz4flnKTya2KKBTP+EQMEhvxQE8jJTCqkQDAf8zQaw+wTRXajhOIbAnY9APneULSkMZ+y5TuYlvtPclDDYeXDAbM4IPGHUxiECY2OQjWuRvsdgY9Wy8HWJ2/Lc04/7WmDAe1zekc08Ty+HfEeo+9DlPziEyt/L7axxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4380c0ac78856a1ca85fe4d20a686776/a59e9/img_1.webp 192w,\n/static/4380c0ac78856a1ca85fe4d20a686776/0ca9f/img_1.webp 384w,\n/static/4380c0ac78856a1ca85fe4d20a686776/7e955/img_1.webp 695w\"\n              sizes=\"(max-width: 695px) 100vw, 695px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4380c0ac78856a1ca85fe4d20a686776/3b721/img_1.png 192w,\n/static/4380c0ac78856a1ca85fe4d20a686776/66595/img_1.png 384w,\n/static/4380c0ac78856a1ca85fe4d20a686776/f5f2a/img_1.png 695w\"\n            sizes=\"(max-width: 695px) 100vw, 695px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4380c0ac78856a1ca85fe4d20a686776/f5f2a/img_1.png\"\n            alt=\"img_1.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Image Sharpening 을 활성화됨 상태로 On 하고 선명도를 조절할 수 있는것으로 확인되는데요</p>\n<p>하나의 변수로 선명도를 나타내고 null 로 비활성화를 나타내도록 가정해보겠습니다.</p>\n<p>다음과 같이 PUT API 를 작성할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">UpdateOptionReq</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> definition <span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span> <span class=\"token comment\">// 선명도</span>\n    <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n        definition <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@PutMapping</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@RequestBody</span> req<span class=\"token operator\">:</span> UpdateOptionReq<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    userOptionService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> definition<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> other<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">UserOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateBy</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> OptionUpdateParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition <span class=\"token operator\">=</span> toBe<span class=\"token punctuation\">.</span>definition <span class=\"token comment\">// null 은 null 로 설정합니다.</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other <span class=\"token operator\">=</span> toBe<span class=\"token punctuation\">.</span>other\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h1>추가 요구 사항 - 1</h1>\n<p>위에서 보여드린 창을 통해서 선명도를 조절할 뿐만 아니라</p>\n<p>게임중에 단축키로 선명도 부분만 조절할 수 있는 기능이 추가되어야 한다고 가정해보겠습니다.</p>\n<p>단축키로 해당 선명도만 조절할 수 있어야 하니 Patch API 로 선명도 부분만 업데이트 되도록 API 를 작성해보겠습니다.</p>\n<h2>Patch API 작성</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">UpdateDefinition</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> definition<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n        definition <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition<span class=\"token punctuation\">,</span>\n        other <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@PatchMapping</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"/definition\"</span></span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">fun</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@RequestBody</span> req<span class=\"token operator\">:</span> UpdateDefinition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    userVolumeService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 작성한다고 하면 어떤 사이드 이펙트가 발생할 수 있을까요??</p>\n<p>우선 Patch API 작성자는 OptionUpdateParams 에 definition 만 넣었을 경우 definition 값만 업데이트 되도록 기대했을 수 있습니다.\n하지만 엔티티의 update 로직을 보면 null 로 들어간 값은 전부다 ‘비활성화’ 처리가 되어 다른 모든 옵션을 끄게되는 불상사가 발생하게 됩니다.</p>\n<h2>버그 수정</h2>\n<p>그럼 기존 엔티티의 업데이트 메소드 외에 patch 전용 메소드를 하나 추가해서 처리하도록 해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">UserOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateBy</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> OptionUpdateParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateDefinition</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition <span class=\"token operator\">=</span> toBe\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>메소드를 추가한 현재 UserOption 엔티티는 기능적으로 문제가 되는 부분은 없어보입니다. 하지만\n코드 품질로 봤을 때 메소드 각각이 모든 프로퍼티를 사용하고 있지 않아 코드의 응집성이 낮다고 볼 수 있습니다.</p>\n<h1>추가 요구 사항 - 2</h1>\n<p>이번에는 게이머의 추가 요청사항으로 단축키로 ‘other’ 를 조절 할 수 있게 해달라는 요구사항이 왔습니다..</p>\n<p>똑같이 API 를 만들어 보겠습니다.</p>\n<h2>Patch API 작성</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">UpdateDefinitionOther</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> other<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n        definition <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        other <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@PatchMapping</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"/other\"</span></span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">fun</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@RequestBody</span> req<span class=\"token operator\">:</span> UpdateDefinitionOther<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    userVolumeService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 기존 PUT 요청 API</span>\n<span class=\"token comment\">// 기존 PATCH definition 업데이트 API </span>\n\n<span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">UserOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateBy</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> OptionUpdateParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateDefinition</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateOther</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> Int<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other <span class=\"token operator\">=</span> toBe\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>문제상황</h2>\n<p>위와 같은 요구사항이 추가될 때마다 도메인의 메소드는 하나씩 추가해야하고 API 도 하나씩 추가해야합니다.</p>\n<p>프론트, 백엔드 개발자 입장에서는 관리해야할 API 가 추가되는 것이며 도메인 엔티티의 테스트 코드도 계속 추가되어야 할것입니다.</p>\n<p>위와 같은 문제상황을 null 을 도메인 로직을 뜻하는 ‘비활성화’로 사용하지 않음으로써\n어떻게 깔끔하게 정리하는지 보도록 하겠습니다.</p>\n<h1>리팩토링</h1>\n<p>도메인 로직의 응집성을 높이면서 관리해야할 API 수를 늘리지 않도록 해보겠습니다.</p>\n<h2>PUT 요청에서 Null 제거</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">/* 기존 코드\ndata class UpdateOptionReq(\n    val definition : Int? // 선명도\n    ...\n) {\n    fun toUpdateParams() = OptionUpdateParams(\n        definition = this.definition,\n        // ...\n    )\n}\n*/</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">UpdateOptionReq</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> definition<span class=\"token operator\">:</span> Definition<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> other<span class=\"token operator\">:</span> Other\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Definition</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">val</span> enable<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">val</span> per<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Other</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">val</span> enable<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">val</span> per<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">fun</span> <span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n        definition <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition<span class=\"token punctuation\">.</span>enable<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition<span class=\"token punctuation\">.</span>per <span class=\"token keyword\">else</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        other <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other<span class=\"token punctuation\">.</span>enable<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other<span class=\"token punctuation\">.</span>per <span class=\"token keyword\">else</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> \n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>도메인 엔티티 응집성 향상</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">UserOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">updateBy</span><span class=\"token punctuation\">(</span>toBe<span class=\"token operator\">:</span> OptionUpdateParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// null 을 도메인 로직에 사용하는 것이 아닌 값의 부재에 사용함</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition <span class=\"token operator\">=</span> toBe<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>definition <span class=\"token operator\">?:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other <span class=\"token operator\">=</span> toBe<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>other <span class=\"token operator\">?:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/* 주석 처리    \n    fun updateDefinition(toBe: Int?) {\n        // ...\n    }\n    \n    fun updateOther(toBe: Int?) {\n        this.other = toBe\n    }\n*/</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>updateBy 메소드 하나로 모든 프로퍼티의 변경을 담당함으로 코드의 응집성이 향상된것을 확인할 수 있습니다.</p>\n<h2>PATCH API 통합  (definition, other)</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">/*\ndata class UpdateDefinition(\n    val definition: Int?\n) {\n    fun toUpdateParams() = OptionUpdateParams(\n        definition = this.definition,\n        other = null\n    )\n}\n\ndata class UpdateDefinitionOther(\n    val other: Int?\n) {\n    fun toUpdateParams() = OptionUpdateParams(\n        definition = null,\n        other = this.other\n    )\n}\n*/</span>\n\n<span class=\"token comment\">// new</span>\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">UpdateParams</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> definition<span class=\"token operator\">:</span> Definition<span class=\"token operator\">?</span>\n    <span class=\"token keyword\">val</span> other<span class=\"token operator\">:</span> Other<span class=\"token operator\">?</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">OptionUpdateParams</span><span class=\"token punctuation\">(</span>\n        definition <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>definition<span class=\"token punctuation\">,</span>\n        other <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>other\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token annotation builtin\">@PatchMapping</span> \n<span class=\"token keyword\">fun</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation builtin\">@RequestBody</span> req<span class=\"token operator\">:</span> UpdateParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    userVolumeService<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">toUpdateParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 변경하면 추가적인 요청사항이 있을 때 마다 해당 Patch 하나를 사용해서 처리를 할 수 있습니다.</p>\n<h1>결론</h1>\n<p>코드의 응집성 향상 및 추가적인 요구사항에 유연하게 처리할 수 있게 되었습니다. 위에서 진행한 리팩토링 외에도</p>\n<p>추가적으로 진행하면 좋은것들이 있는데요 Definition, Other class 를 도메인 엔티티에 넣음으로써\n추가 리팩토링(validation)을 진행할 수 있습니다.</p>\n<p>도메인 엔티티로 옮기면 좋은점들은 <a href=\"https://cheese10yun.github.io/spring-jpa-best-04/\" target=\"_blank\" rel=\"nofollow\">다음 블로그</a> 에서 확인가능합니다.</p>","frontmatter":{"title":"kotlin 과 Spring WebMVC 로 효율적인 Patch API 작성하기","summary":"Patch API를 kotlin과 Spring WebMVC 로 효율적으로 작성해봅니다. (부제: null 사용하지 않기)","date":"2023.07.30.","categories":["kotlin","‘http’"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42u2U207CQBCG+8g+go9hYvTCExeoGAWDB2JQsIDFghwUiJwKrXLoAkVUvPidWUAw8cIE4pUXf3e7s/v905lmlZ5dwyKl/AMXC3REfXFAhomWgX5nPqjSIchwYCEQTGBp2YtS8REv3Qm0Do5326zaeBypJ+j9RyAFPwioJ+/hP9cl8K1vwm5U5YHhi4W3nol3h0bHJFl4pZGNBrTuiJrUt082KkX4Azo8xzcIhu9kBmo0De9pHFEtg0TyAXriHvHbrDSOxTO4UlNIp3MQTQNtNm+Pgc2nKjTamM8XcKNlkcsVpI78GtZdIRyQyfZeBKtbIbgPY9h0q3DtRxCOpOAjQzU2Mj670FEghsKHr65TaBGYg+x4QtnG9ax05lpxWdidY9y4SUY8t2mNy1MpF9GwKlCezQplEsbaTghbuypWNi7h8Wl4pfpMOu5Qc7hOfVGXf8PXupiKG8kxhR/sxkUWY/Hmrj3t4uz8V//hrNNsx/4vhz8CitE9MNKcQIY0n8owjBLsliX1CTPZynf2Ss39AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/kotlin-patch-api/"}},"staticQueryHashes":[],"slicesMap":{}}