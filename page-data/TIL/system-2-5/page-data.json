{"componentChunkName":"component---src-templates-post-template-tsx","path":"/TIL/system-2-5/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>지표 모니터링 및 경보 시스템</h1>\n<h2>문제 이해 및 설계 범위 확정</h2>\n<h3>개략적 요구사항 및 가정</h3>\n<ul>\n<li>대규모 인프라를 모니터링.\n<ul>\n<li>DAU 1억</li>\n<li>서버 풀 1,000대, 풀당 서버 수 100개, 서버당 100개의 운영지표 수집한다고 치면<br>\n모니터링 해야하는 지표의 수는 천만 개 수준.</li>\n<li>데이터 보관 기간은 1년</li>\n<li>수집한 그대로 데이터를 보관하는 기간은 일주일. 그 뒤에는 1분 단위데이터로 변환한 후에 30일간 보관. 그 뒤에는 1시간 단위 데이터로 변환한 뒤에 1년간 보관.</li>\n</ul>\n</li>\n<li>모니터링 해야할 지표\n<ul>\n<li>CPU 사용률</li>\n<li>메모리 사용률</li>\n<li>요청 수</li>\n<li>메시지 큐 내의 메시지 수</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>AWS CloudWatch 비용</p>\n<ol>\n<li>기본 메트릭 비용은 무료. 네임스페이스가 AWS/ 로 시작하는 메트릭은 무료.</li>\n<li>커스텀 메트릭은 별도의 비용이 부과됨.</li>\n<li>CloudWatch API 호출에 비용 발생.</li>\n</ol>\n</blockquote>\n<h3>비기능 요구사항</h3>\n<ul>\n<li>규모 확장성</li>\n<li>낮은 응답 지연\n<ul>\n<li>대시보드와 경보를 신속하게 처리가능 하도록 질의(query)에 대한 낮은 응답지연을 제공.</li>\n</ul>\n</li>\n<li>안정성</li>\n<li>유연성\n<ul>\n<li>미래의 신기술을 쉽게 통합할 수 있도록 설계.</li>\n</ul>\n</li>\n</ul>\n<h2>개략적 설계안 제시 및 동의 구하기</h2>\n<h3>기본적 사항.</h3>\n<ul>\n<li>데이터 수집기: CloudWatch Agent, Telegraf</li>\n</ul>\n<blockquote>\n<p>로그 수집: Fluentbit, Logstash</p>\n</blockquote>\n<ul>\n<li>데이터 전송</li>\n<li>데이터 저장소</li>\n<li>경보: 이상징후 감지 및 다양한 통신 채널로 경보 발송</li>\n</ul>\n<h3>데이터 모델</h3>\n<p>지표 데이터는 통상 “시계열” 데이터로 저장</p>\n<p>모든 시계열 데이터는 다음 정보들로 구성</p>\n<table>\n<thead>\n<tr>\n<th>이름</th>\n<th>자료형</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>지표 이름</td>\n<td>문자열</td>\n</tr>\n<tr>\n<td>태그/레비을 집함</td>\n<td>&#x3C;키:값> 쌍의 리스트</td>\n</tr>\n<tr>\n<td>지표 값 및 타임스탬프의 배열</td>\n<td>&#x3C;값, 타임스탬프> 쌍의 리스트</td>\n</tr>\n</tbody>\n</table>\n<h3>데이터 접근 패턴</h3>\n<ul>\n<li>쓰기 부하는 막대함.</li>\n<li>읽기 부하는 일시적으로 치솟았다 사라짐 (spike)</li>\n</ul>\n<h3>데이터 저장소 시스템</h3>\n<p>일반 데이터베이스 및 NoSQL</p>\n<ul>\n<li>일반 데이터베이스로는 전문가급 튜닝이 필요</li>\n<li>시계열 데이터 쿼리문 작성이 힘듬.</li>\n</ul>\n<p>시계열 데이터베이스</p>\n<ul>\n<li>InfluxDB, OpenTSDB, Prometheus</li>\n</ul>\n<h2>상세 설계</h2>\n<h3>지표 수집</h3>\n<p>일부 지표가 사라져도 괜찮다는 특징을 가지고 있음.</p>\n<ul>\n<li>풀 모델\n<ul>\n<li>prometheus 가 대표적</li>\n<li>Service Discovery 기능의 도움이 필요\n예) <a href=\"https://stdhsw.tistory.com/entry/Prometheus%EA%B0%80-Kubernetes-service-discover%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" target=\"_blank\" rel=\"nofollow\">k8s 환경</a></li>\n<li>안정 해시 알고리즘을 사용하여 특정 서버에 대한 요청을 분산시킴.</li>\n<li>손쉬운 디버깅 가능</li>\n<li>health check 기능을 제공</li>\n<li>TCP</li>\n</ul>\n</li>\n<li>풀 모델\n<ul>\n<li>cloudwatch 가 대표적</li>\n<li>로드밸런서가 필요</li>\n<li>UDP</li>\n<li>데이터 신빙성 문제가 있으나 Authentication 설정으로 해결가능.</li>\n</ul>\n</li>\n</ul>\n<p>데이터 저장소에 문제가 생기면 데이터 손실이 발생.</p>\n<p>큐 시스템(Kafka) 도입으로 문제 해결가능.<br>\n장점</p>\n<ul>\n<li>데이터 수집 컴포넌트와 처리 컴포넌트간의 결합도를 낮춤.</li>\n<li>데이터베이스 장애 발생시 카프카 데이터로부터 복구가능.\n단점</li>\n<li>데이터 저장소에 비해 복잡도가 높음.</li>\n</ul>\n<h3>데이터 집계 지점.</h3>\n<ol>\n<li>\n<p>수집 에이전트가 집계</p>\n<ul>\n<li>복잡한 집계로직은 힘듬. 분 단위로 집계하여 지표에 보내는 것 정도.</li>\n</ul>\n</li>\n<li>\n<p>데이터 수집 파이프라인에서 집계</p>\n<ul>\n<li>플링크 같은 스트림 프로세싱 엔진이 필요.</li>\n<li>늦게 도착하는 지표 데이터의 처리가 힘듬.</li>\n<li>원본 데이터를 저장하지 않기 때문에 정밀도나 유연성 측면에서 손해</li>\n</ul>\n</li>\n<li>\n<p>질의 시에 집계</p>\n<ul>\n<li>데이터 손실은 문제 없으나 속도 이슈가 발생가능</li>\n</ul>\n</li>\n</ol>\n<h3>질의 서비스</h3>\n<ul>\n<li>캐시 계층 도입\n질의 부하를 낮추고 서비스의 성능을 높일 수 있음.</li>\n</ul>\n<h3>질의 서비스를 두면 곤란한 경우</h3>\n<p>대부분의 시각화 및 경보 시스템은\n이미 시계열 데이터베이스와 연동을 처리하는 강력한 플러그인을 갖추고 있는 경우가 대부분.</p>\n<h3>저장소 계층 - 저장 용량 최적화</h3>\n<p>문제: 지표 모니터링에 저장할 데이터의 양은 많음.</p>\n<p>해결방법: 데이터 인코딩 및 압축 기법</p>\n<ol>\n<li>Timestamp의 차이만 저장하는 방법</li>\n<li>다운샘플링 기법\n7일 이내 데이터-> No Sampling<br>\n7일 이후 데이터 -> 1분 단위 데이터로 변환 후 30일간 보관</li>\n<li>Cold Storage (AWS Glacier Storage)</li>\n</ol>\n<h3>경보 시스템</h3>\n<ul>\n<li>Prometheus Alertmanager</li>\n<li>AWS CloudWatch Alarm</li>\n</ul>\n<h3>시각화 시스템</h3>\n<ul>\n<li>Grafana</li>\n<li>AWS Managed Grafana</li>\n</ul>","fields":{"category":"TIL"},"frontmatter":{"title":"5장 지표 모니터링 및 경보 시스템","summary":"대규모 시스템 설계 기초 2 5장 지표 모니터링 및 경보 시스템 발표 자료","date":"2024.11.27.","tags":["study","TIL"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42u2U207CQBCG+8g+go9hYvTCExeoGAWDB2JQsIDFghwUiJwKrXLoAkVUvPidWUAw8cIE4pUXf3e7s/v905lmlZ5dwyKl/AMXC3REfXFAhomWgX5nPqjSIchwYCEQTGBp2YtS8REv3Qm0Do5326zaeBypJ+j9RyAFPwioJ+/hP9cl8K1vwm5U5YHhi4W3nol3h0bHJFl4pZGNBrTuiJrUt082KkX4Azo8xzcIhu9kBmo0De9pHFEtg0TyAXriHvHbrDSOxTO4UlNIp3MQTQNtNm+Pgc2nKjTamM8XcKNlkcsVpI78GtZdIRyQyfZeBKtbIbgPY9h0q3DtRxCOpOAjQzU2Mj670FEghsKHr65TaBGYg+x4QtnG9ax05lpxWdidY9y4SUY8t2mNy1MpF9GwKlCezQplEsbaTghbuypWNi7h8Wl4pfpMOu5Qc7hOfVGXf8PXupiKG8kxhR/sxkUWY/Hmrj3t4uz8V//hrNNsx/4vhz8CitE9MNKcQIY0n8owjBLsliX1CTPZynf2Ss39AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/TIL/system-2-5","category":"TIL"}},"staticQueryHashes":["2433549356","3142469158"],"slicesMap":{}}