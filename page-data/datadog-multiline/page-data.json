{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/datadog-multiline/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>k8s 로깅 아키텍처</h2>\n<p>k8s에서 로그를 처리하는 방법에는 여러가지가 있다.</p>\n<ul>\n<li>어플리케이션 레벨에서 바로 로그수집기로 전달하는 구조</li>\n<li>사이드카에서 로그를 전달하는 구조</li>\n<li>컨테이너의 std 를 노드에 파일로 저장 후 수집기가 해당 파일을 읽어가는 구조</li>\n</ul>\n<p>현재 이 중 3번째에 해당하는 방식으로 로그를 수집하고 있는데 기본 설정으로는 Datadog에서 java 의 스택트레이스를 하나의 로그로 인식하지 않는다. 물론 다른 로그 수집기를 사용하더라도\n별도의 설정을 추가하지 않는 이상 별반 다르지 않다.\n이는 스택트레이스를 여러줄로 json 형태로 저장하고 단순히 읽어가기 때문이다.</p>\n<p>스택트레이스를 로그하나하나 나누면 비용도 커질뿐만 아니라 로그 보는데이도 불편하기 때문에 하나로 합치는 과정이 필요하다.</p>\n<p>다음의 multiline 설정을 deployment에 추가해주면 datadog agent 가 스택트레이스가 하나의 로그로 합쳐서 보여준다</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>deployment\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ad.datadoghq.com/nginx-service.logs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">-</span>\n      <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token key atrule\">\"source\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token key atrule\">\"service\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"nginx-service\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token key atrule\">\"auto_multi_line_detection\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token key atrule\">\"log_processing_rules\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token key atrule\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"multi_line\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token key atrule\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"new_log_start_with_date\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token key atrule\">\"pattern\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\\\d{4}-(0?[1-9]|1[012])-(0?[1-9]|[12][0-9]|3[01])\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n~</code></pre></div>","frontmatter":{"title":"Datadog 멀티라인 로그 설정","summary":"Json 포맷 또는 logback encoder 를 사용하지 않고 stdout 스택트레이스를 한줄로 로깅해봅니다.","date":"2022.09.22.","categories":["kubernetes","datadog"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQ4y+VU207CQBDtH/sJ/oYx0UQl8oDRxEtUgsYLVitQUBAQIyAFKkJbKCJGkz1mhhYqYsBLfPHhZDK72zNnZs9Wss0yfgHCNspomWUh/UPClqHxIkUXbv5jwraH6NuEfTKrDKvei6PUjskHhM2GhpeOjtBBAlPTGyjkb9FpVvrVab9paL3owRCxcCMTvnZ0xBMZbIdUJnxuV2E8lPjwy6OOrl3ltW7biXaVSZ9aFR5Tm1p2WueWS3d57OypWNuK4DB8wUSyksTmbgxKJIXERQZqPI2omubC59ErHMuXSKayMOslGLXSQGH9/o4P5nI3fPD6OsdY34li3n/CRXwrp5j1HSOwrmAxIGN59QwnZ0lsBmOQlRQVFsH9OHEIKZvN4Ui+BBGfKimuSGpjaprbdudICmjPIkXOOKyGBvOBc1Es3KKmF4VUqxYx7w9jbjmMpYCMmYUjrG5F0LUrfONee1DuYmhd0EVSlFzvkWUsVvDRGhNgMMPPDPxFg79/KaPgVfknP4ehou99OB78sWixgflj4ZAIZ36DGU7++DVQW314VNJL4dufQKGjgklEP3eUkU3q9wWhaXlhNnSYDV28AXiLyL1VwKH9AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/datadog-multiline/"}},
    "staticQueryHashes": []}