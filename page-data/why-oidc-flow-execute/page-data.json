{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/why-oidc-flow-execute/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>발생 원인</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.52083333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz52RW2+jMBCF+f//bPdlFUWRQrikgIEUMBhfAAPmVB7abrWPO9Kn47HnjM0Q8EGjaVrc73dEUYQwDJGmKbQ2UEpBKX2i9d/1J/pf1RrBcYBi21bs+0445/C/EVhrUZYlkSQJvc7r8/lEHMf0ar/2+z5/PB6IkxhJlCALK2QhQxaWSKMnpmlCsCwLuo5T8eVywfV6JW63G42hKAqirmvkeU74yxljKFmJImdgBaPcGIPAf561C9Z1/ca/2tpzBH4ix3EQX/GV/9zfto28gTe9Ny2UkpiMoVu8whd6g3Nw+07Fm2fbaMbH4eDcTmc+OO8gpUQglMWfSOL13qDlAkIaVK8GQmr0QkLqiTSKUzzfCiRphqbrIUYFZWYos3zrvKwIBrXj111Dzgd67TAYh7KRSFmLtGjBmhFcbXirOJHVw6lVj6pT6PVOHq53yNmdDX9Tw7NZrzdq0ooFnVzB1YpOWmQVR/Ea6CyvexQvgWaYISYHYU6v8g0Xu4JVLUapiN0dEKME7wdoM9NPmRdL+U/6QRCDGKleaUPeD/10+g4fvl5UAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eff334ef339fe87f68b513d92a6bc77b/a59e9/google-scope.webp 192w,\n/static/eff334ef339fe87f68b513d92a6bc77b/0ca9f/google-scope.webp 384w,\n/static/eff334ef339fe87f68b513d92a6bc77b/891ea/google-scope.webp 715w\"\n              sizes=\"(max-width: 715px) 100vw, 715px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eff334ef339fe87f68b513d92a6bc77b/3b721/google-scope.png 192w,\n/static/eff334ef339fe87f68b513d92a6bc77b/66595/google-scope.png 384w,\n/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png 715w\"\n            sizes=\"(max-width: 715px) 100vw, 715px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png\"\n            alt=\"Google_Scope\"\n            title=\"Google_Scope\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>google oauth2 설정을 했을 때 다음과같이 범위를 지정하였습니다.</p>\n<ul>\n<li>email</li>\n<li>profile</li>\n<li>openid</li>\n</ul>\n<p>이후</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">oauth2</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">registration</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">google</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">client-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_ID<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">client-secret</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_SECRET<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">scope</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> email\n              <span class=\"token punctuation\">-</span> profile\n              <span class=\"token punctuation\">-</span> openid</code></pre></div>\n<p>다음과 같이 지정하였으며</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">CustomUserDetailsService</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> memberRepository<span class=\"token operator\">:</span> MemberRepository\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>UserDetailsService<span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> UserDetails <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> member <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByEmail</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">UsernameNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"해당하는 유저가 없습니다. : <span class=\"token interpolation\"><span class=\"token delimiter variable\">${</span>username<span class=\"token delimiter variable\">}</span></span>\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> MemberPrincipal<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 CustomUserDetails 를 반환하도록 구현하였습니다.</p>\n<p>하지만 기본적으로 적용된 OAuth2LoginAuthenticationProvider 클래스 내에서\nopenid가 scope에 포함되어있으면\n다음 부분에서 저희가 등록한 CustomUserDetailsService 가 동작하지 않고\n다음 provider로 넘어가게 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a806a53c1f502e2da37035a535ce86cb/46d5f/openid-skip-provider.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.0625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYUlEQVQoz2WSW2/cIBSE/YMSm4uBA5irvbtppFz60Ickippu//9vmMpnt1XTPnyaOSMYkGAIXqMVAx8TQgjI0SHECB8XUIicEzkET+zjkjm3jhhjHcyuVwY93SJ5Qq8FLUdsNWGtGb1kpOCRokeOHmXxCGThrQEZzRg1YZY7I+s+D+P6Dfr+HeHrT/jnM+jpDP90Bj1+wD18wD58Bz3+YK+/vEGeXiBOLxiPFxWn16t/5XmQlCBcQlrvkI/3iNsdQjuCygG+Hlhd3mDTCh0qJOX/EH/5QUsJqwX8PMHICVoKZlby4pX4kyk5QYw3EOPtVW8gps9+UEpfHqOuKH1DqR25NCy5IJWKXBty7ShtRcoVjghu1rCzgzPE2J3ZQUp1KZyEgJQS5ANaa2i9o/YD2npA347MfojWGkopKCWvqqHV70xxx7AvIqNA5LmwtM43ikvib+F2yMNaxxuEEJ/4N/sFpMILsBnPw1EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a806a53c1f502e2da37035a535ce86cb/a59e9/openid-skip-provider.webp 192w,\n/static/a806a53c1f502e2da37035a535ce86cb/0ca9f/openid-skip-provider.webp 384w,\n/static/a806a53c1f502e2da37035a535ce86cb/dc9b9/openid-skip-provider.webp 768w,\n/static/a806a53c1f502e2da37035a535ce86cb/e2c2f/openid-skip-provider.webp 1152w,\n/static/a806a53c1f502e2da37035a535ce86cb/09a89/openid-skip-provider.webp 1364w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a806a53c1f502e2da37035a535ce86cb/3b721/openid-skip-provider.png 192w,\n/static/a806a53c1f502e2da37035a535ce86cb/66595/openid-skip-provider.png 384w,\n/static/a806a53c1f502e2da37035a535ce86cb/fe486/openid-skip-provider.png 768w,\n/static/a806a53c1f502e2da37035a535ce86cb/d2d74/openid-skip-provider.png 1152w,\n/static/a806a53c1f502e2da37035a535ce86cb/46d5f/openid-skip-provider.png 1364w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a806a53c1f502e2da37035a535ce86cb/fe486/openid-skip-provider.png\"\n            alt=\"SKIP_Provider\"\n            title=\"SKIP_Provider\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2>해결 방법</h2>\n<p>일단은 openid 를 제거하는 방법으로 해결했습니다.</p>\n<p>추후에 OAuth2 와 OIDC 차이점을 정리해보겠습니다.</p>","frontmatter":{"title":"oauth2 scope openid","summary":"spring boot oauth2 client 연동시 scope openid 를 지정했을 때 발생하는 에러","date":"2022.09.18.","categories":["oauth2","spring boot"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQ4y+VU207CQBDtH/sJ/oYx0UQl8oDRxEtUgsYLVitQUBAQIyAFKkJbKCJGkz1mhhYqYsBLfPHhZDK72zNnZs9Wss0yfgHCNspomWUh/UPClqHxIkUXbv5jwraH6NuEfTKrDKvei6PUjskHhM2GhpeOjtBBAlPTGyjkb9FpVvrVab9paL3owRCxcCMTvnZ0xBMZbIdUJnxuV2E8lPjwy6OOrl3ltW7biXaVSZ9aFR5Tm1p2WueWS3d57OypWNuK4DB8wUSyksTmbgxKJIXERQZqPI2omubC59ErHMuXSKayMOslGLXSQGH9/o4P5nI3fPD6OsdY34li3n/CRXwrp5j1HSOwrmAxIGN59QwnZ0lsBmOQlRQVFsH9OHEIKZvN4Ui+BBGfKimuSGpjaprbdudICmjPIkXOOKyGBvOBc1Es3KKmF4VUqxYx7w9jbjmMpYCMmYUjrG5F0LUrfONee1DuYmhd0EVSlFzvkWUsVvDRGhNgMMPPDPxFg79/KaPgVfknP4ehou99OB78sWixgflj4ZAIZ36DGU7++DVQW314VNJL4dufQKGjgklEP3eUkU3q9wWhaXlhNnSYDV28AXiLyL1VwKH9AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/why-oidc-flow-execute/"}},
    "staticQueryHashes": []}