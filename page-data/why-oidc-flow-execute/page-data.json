{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/why-oidc-flow-execute/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>발생 원인</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.52083333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz52RW2+jMBCF+f//bPdlFUWRQrikgIEUMBhfAAPmVB7abrWPO9Kn47HnjM0Q8EGjaVrc73dEUYQwDJGmKbQ2UEpBKX2i9d/1J/pf1RrBcYBi21bs+0445/C/EVhrUZYlkSQJvc7r8/lEHMf0ar/2+z5/PB6IkxhJlCALK2QhQxaWSKMnpmlCsCwLuo5T8eVywfV6JW63G42hKAqirmvkeU74yxljKFmJImdgBaPcGIPAf561C9Z1/ca/2tpzBH4ix3EQX/GV/9zfto28gTe9Ny2UkpiMoVu8whd6g3Nw+07Fm2fbaMbH4eDcTmc+OO8gpUQglMWfSOL13qDlAkIaVK8GQmr0QkLqiTSKUzzfCiRphqbrIUYFZWYos3zrvKwIBrXj111Dzgd67TAYh7KRSFmLtGjBmhFcbXirOJHVw6lVj6pT6PVOHq53yNmdDX9Tw7NZrzdq0ooFnVzB1YpOWmQVR/Ea6CyvexQvgWaYISYHYU6v8g0Xu4JVLUapiN0dEKME7wdoM9NPmRdL+U/6QRCDGKleaUPeD/10+g4fvl5UAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eff334ef339fe87f68b513d92a6bc77b/a59e9/google-scope.webp 192w,\n/static/eff334ef339fe87f68b513d92a6bc77b/0ca9f/google-scope.webp 384w,\n/static/eff334ef339fe87f68b513d92a6bc77b/891ea/google-scope.webp 715w\"\n              sizes=\"(max-width: 715px) 100vw, 715px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eff334ef339fe87f68b513d92a6bc77b/3b721/google-scope.png 192w,\n/static/eff334ef339fe87f68b513d92a6bc77b/66595/google-scope.png 384w,\n/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png 715w\"\n            sizes=\"(max-width: 715px) 100vw, 715px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eff334ef339fe87f68b513d92a6bc77b/277d6/google-scope.png\"\n            alt=\"Google_Scope\"\n            title=\"Google_Scope\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>google oauth2 설정을 했을 때 다음과같이 범위를 지정하였습니다.</p>\n<ul>\n<li>email</li>\n<li>profile</li>\n<li>openid</li>\n</ul>\n<p>이후</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">oauth2</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">registration</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">google</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">client-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_ID<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">client-secret</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_SECRET<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">scope</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> email\n              <span class=\"token punctuation\">-</span> profile\n              <span class=\"token punctuation\">-</span> openid</code></pre></div>\n<p>다음과 같이 지정하였으며</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin20-30\"><pre class=\"language-kotlin20-30\"><code class=\"language-kotlin20-30\">class CustomAuthenticationProvider(\n    private val passwordEncoder: PasswordEncoder,\n    private val customUserDetailsService: CustomUserDetailsService,\n): AbstractUserDetailsAuthenticationProvider() {\n    override fun additionalAuthenticationChecks(\n        userDetails: UserDetails?,\n        authentication: UsernamePasswordAuthenticationToken?\n    ) {\n        if (authentication!!.credentials == null) {\n            logger.debug(&quot;Failed to authenticate since no credentials provided&quot;)\n            throw BadCredentialsException(\n                messages\n                    .getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;)\n            )\n        }\n        val password = authentication.credentials.toString()\n        if(!passwordEncoder.matches(password, userDetails?.password)) {\n            throw BadCredentialsException(\n                messages\n                    .getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;)\n            )\n        }\n    }\n\n    override fun retrieveUser(username: String, authentication: UsernamePasswordAuthenticationToken?): UserDetails {\n        try {\n            val loadedUser: UserDetails = customUserDetailsService.loadUserByUsername(username)\n            return loadedUser\n        } catch (ex: UsernameNotFoundException) {\n            throw ex;\n        } catch (ex: InternalAuthenticationServiceException) {\n            throw ex;\n        } catch (ex: Exception) {\n            throw InternalAuthenticationServiceException(ex.message, ex)\n        }\n\n    }\n}</code></pre></div>","frontmatter":{"title":"oauth2 scope openid","summary":"spring boot oauth2 client 연동시 scope openid 를 지정했을 때 발생하는 에러","date":"2022.09.18.","categories":["oauth2","spring boot"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQ4y+VU207CQBDtH/sJ/oYx0UQl8oDRxEtUgsYLVitQUBAQIyAFKkJbKCJGkz1mhhYqYsBLfPHhZDK72zNnZs9Wss0yfgHCNspomWUh/UPClqHxIkUXbv5jwraH6NuEfTKrDKvei6PUjskHhM2GhpeOjtBBAlPTGyjkb9FpVvrVab9paL3owRCxcCMTvnZ0xBMZbIdUJnxuV2E8lPjwy6OOrl3ltW7biXaVSZ9aFR5Tm1p2WueWS3d57OypWNuK4DB8wUSyksTmbgxKJIXERQZqPI2omubC59ErHMuXSKayMOslGLXSQGH9/o4P5nI3fPD6OsdY34li3n/CRXwrp5j1HSOwrmAxIGN59QwnZ0lsBmOQlRQVFsH9OHEIKZvN4Ui+BBGfKimuSGpjaprbdudICmjPIkXOOKyGBvOBc1Es3KKmF4VUqxYx7w9jbjmMpYCMmYUjrG5F0LUrfONee1DuYmhd0EVSlFzvkWUsVvDRGhNgMMPPDPxFg79/KaPgVfknP4ehou99OB78sWixgflj4ZAIZ36DGU7++DVQW314VNJL4dufQKGjgklEP3eUkU3q9wWhaXlhNnSYDV28AXiLyL1VwKH9AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/why-oidc-flow-execute/"}},
    "staticQueryHashes": []}