{"componentChunkName":"component---src-templates-post-template-tsx","path":"/_DelSyncFiles/why-oidc-flow-execute/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>발생 원인</h2>\n<p><img src=\"./google-scope.png\" alt=\"Google_Scope\"></p>\n<p>google oauth2 설정을 했을 때 다음과같이 범위를 지정하였습니다.</p>\n<ul>\n<li>email</li>\n<li>profile</li>\n<li>openid</li>\n</ul>\n<p>이후</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">oauth2</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">registration</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">google</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">client-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_ID<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">client-secret</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>GOOGLE_CLIENT_SECRET<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">scope</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> email\n              <span class=\"token punctuation\">-</span> profile\n              <span class=\"token punctuation\">-</span> openid</code></pre></div>\n<p>다음과 같이 지정하였으며</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">CustomUserDetailsService</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> memberRepository<span class=\"token operator\">:</span> MemberRepository\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>UserDetailsService<span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> UserDetails <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> member <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByEmail</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">UsernameNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"해당하는 유저가 없습니다. : </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">username</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> MemberPrincipal<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 CustomUserDetails 를 반환하도록 구현하였습니다.</p>\n<p>하지만 기본적으로 적용된 OAuth2LoginAuthenticationProvider 클래스 내에서\nopenid가 scope에 포함되어있으면\n다음 부분에서 저희가 등록한 CustomUserDetailsService 가 동작하지 않고\n다음 provider로 넘어가게 됩니다.</p>\n<p><img src=\"./openid-skip-provider.png\" alt=\"SKIP_Provider\"></p>\n<h2>해결 방법</h2>\n<p>일단은 openid 를 제거하는 방법으로 해결했습니다.</p>\n<p>추후에 OAuth2 와 OIDC 차이점을 정리해보겠습니다.</p>","frontmatter":{"title":"oauth2 scope openid","summary":"spring boot oauth2 client 연동시 scope openid 를 지정했을 때 발생하는 에러","date":"2022.09.18.","categories":["oauth2","spring boot"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42u2U207CQBCG+8g+go9hYvTCExeoGAWDB2JQsIDFghwUiJwKrXLoAkVUvPidWUAw8cIE4pUXf3e7s/v905lmlZ5dwyKl/AMXC3REfXFAhomWgX5nPqjSIchwYCEQTGBp2YtS8REv3Qm0Do5326zaeBypJ+j9RyAFPwioJ+/hP9cl8K1vwm5U5YHhi4W3nol3h0bHJFl4pZGNBrTuiJrUt082KkX4Azo8xzcIhu9kBmo0De9pHFEtg0TyAXriHvHbrDSOxTO4UlNIp3MQTQNtNm+Pgc2nKjTamM8XcKNlkcsVpI78GtZdIRyQyfZeBKtbIbgPY9h0q3DtRxCOpOAjQzU2Mj670FEghsKHr65TaBGYg+x4QtnG9ax05lpxWdidY9y4SUY8t2mNy1MpF9GwKlCezQplEsbaTghbuypWNi7h8Wl4pfpMOu5Qc7hOfVGXf8PXupiKG8kxhR/sxkUWY/Hmrj3t4uz8V//hrNNsx/4vhz8CitE9MNKcQIY0n8owjBLsliX1CTPZynf2Ss39AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png","srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,\n/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,\n/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/a229594a2de7c0ed63d877869e75fd38/common.png"}}}}]}},"pageContext":{"slug":"/_DelSyncFiles/why-oidc-flow-execute/"}},"staticQueryHashes":[],"slicesMap":{}}