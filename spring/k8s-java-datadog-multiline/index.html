<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><meta data-react-helmet="true" name="description" content="Kubernetes 환경에서 Datadog을 사용할 때, JSON 포맷이나 Logback Encoder를 사용하지 않고 stdout으로 출력되는 Java 스택 트레이스를 하나의 로그로 처리하는 방법을 알아봅니다."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Kubernetes에서 Datadog을 사용하여 멀티라인 Java 로그 설정하기"/><meta data-react-helmet="true" property="og:description" content="Kubernetes 환경에서 Datadog을 사용할 때, JSON 포맷이나 Logback Encoder를 사용하지 않고 stdout으로 출력되는 Java 스택 트레이스를 하나의 로그로 처리하는 방법을 알아봅니다."/><meta data-react-helmet="true" property="og:image" content="https://blog.woos.dev/static/a229594a2de7c0ed63d877869e75fd38/common.png"/><meta data-react-helmet="true" property="og:url" content="https://blog.woos.dev"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Kubernetes에서 Datadog을 사용하여 멀티라인 Java 로그 설정하기"/><meta data-react-helmet="true" name="twitter:description" content="Kubernetes 환경에서 Datadog을 사용할 때, JSON 포맷이나 Logback Encoder를 사용하지 않고 stdout으로 출력되는 Java 스택 트레이스를 하나의 로그로 처리하는 방법을 알아봅니다."/><meta data-react-helmet="true" name="twitter:image" content="https://blog.woos.dev/static/a229594a2de7c0ed63d877869e75fd38/common.png"/><style data-href="/styles.9e907bc32054b7771552.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="canonical" href="https://blog.woos.dev/spring/k8s-java-datadog-multiline/" data-baseprotocol="https:" data-basehost="blog.woos.dev"/><title data-react-helmet="true">Kubernetes에서 Datadog을 사용하여 멀티라인 Java 로그 설정하기</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global rtmpxr">@import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:나눔고딕,'NanumGothic',Nanum Gothic,sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css 11pfcjj">.css-11pfcjj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}</style><div class="css-11pfcjj ef79xez0"> <main><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp e1opi4mu1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo e1opi4mu0"><div style="max-width:1080px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;1080&#x27;%20width=&#x27;1080&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42u2U207CQBCG+8g+go9hYvTCExeoGAWDB2JQsIDFghwUiJwKrXLoAkVUvPidWUAw8cIE4pUXf3e7s/v905lmlZ5dwyKl/AMXC3REfXFAhomWgX5nPqjSIchwYCEQTGBp2YtS8REv3Qm0Do5326zaeBypJ+j9RyAFPwioJ+/hP9cl8K1vwm5U5YHhi4W3nol3h0bHJFl4pZGNBrTuiJrUt082KkX4Azo8xzcIhu9kBmo0De9pHFEtg0TyAXriHvHbrDSOxTO4UlNIp3MQTQNtNm+Pgc2nKjTamM8XcKNlkcsVpI78GtZdIRyQyfZeBKtbIbgPY9h0q3DtRxCOpOAjQzU2Mj670FEghsKHr65TaBGYg+x4QtnG9ax05lpxWdidY9y4SUY8t2mNy1MpF9GwKlCezQplEsbaTghbuypWNi7h8Wl4pfpMOu5Qc7hOfVGXf8PXupiKG8kxhR/sxkUWY/Hmrj3t4uz8V//hrNNsx/4vhz8CitE9MNKcQIY0n8owjBLsliX1CTPZynf2Ss39AAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w" sizes="(min-width: 1080px) 1080px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1080px) 1080px, 100vw" decoding="async" loading="lazy" data-src="/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png" data-srcset="/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/a229594a2de7c0ed63d877869e75fd38/7e223/common.webp 270w,/static/a229594a2de7c0ed63d877869e75fd38/5cfb6/common.webp 540w,/static/a229594a2de7c0ed63d877869e75fd38/941f9/common.webp 1080w" sizes="(min-width: 1080px) 1080px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1080px) 1080px, 100vw" decoding="async" loading="lazy" src="/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png" srcSet="/static/a229594a2de7c0ed63d877869e75fd38/f1689/common.png 270w,/static/a229594a2de7c0ed63d877869e75fd38/42fd3/common.png 540w,/static/a229594a2de7c0ed63d877869e75fd38/d0859/common.png 1080w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css hsn85d">.css-hsn85d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-hsn85d{width:100%;padding:20px;}}</style><div class="css-hsn85d e1st1jau7"><style data-emotion="css 175ryad">.css-175ryad{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:40px;}</style><div class="css-175ryad e1st1jau3"><style data-emotion="css gywgo7">.css-gywgo7{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-gywgo7{width:30px;height:30px;font-size:18px;}}</style><div class="css-gywgo7 e1st1jau6"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg></div><style data-emotion="css ellqtz">.css-ellqtz{display:none;}@media (max-width: 768px){.css-ellqtz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;top:20px;right:20px;width:40px;height:40px;border:none;background:transparent;color:white;font-size:24px;cursor:pointer;z-index:100;}}</style><button class="css-ellqtz e1st1jau2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"></path></svg></button></div><style data-emotion="css gn4qtp">.css-gn4qtp{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-gn4qtp{font-size:30px;}}</style><div class="css-gn4qtp e1st1jau5">Kubernetes에서 Datadog을 사용하여 멀티라인 Java 로그 설정하기</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e1st1jau4"><div>Kubernetes, Datadog, Logging</div><div>2022.09.22.</div></div><style data-emotion="css ptdzip">.css-ptdzip{display:none;}@media (max-width: 768px){.css-ptdzip{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0, 0, 0, 0.7);z-index:90;opacity:0;visibility:hidden;-webkit-transition:opacity 0.3s ease-in-out,visibility 0.3s ease-in-out;transition:opacity 0.3s ease-in-out,visibility 0.3s ease-in-out;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);}}</style><div class="css-ptdzip e1st1jau1"><style data-emotion="css 11uhifz">.css-11uhifz{position:fixed;top:0;right:0;width:80%;max-width:300px;height:100%;background-color:#29323c;padding:60px 20px 20px;overflow-y:auto;box-shadow:-2px 0 8px rgba(0, 0, 0, 0.2);-webkit-transform:translateX(100%);-moz-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);-webkit-transition:-webkit-transform 0.3s ease-in-out;transition:transform 0.3s ease-in-out;}.css-11uhifz *{color:white;}</style><div class="css-11uhifz e1st1jau0"><style data-emotion="css 1wpu666">.css-1wpu666{width:100%;padding:0.5rem;}</style><nav class="css-1wpu666 e15bpype3"><style data-emotion="css 16tlvlx">.css-16tlvlx{margin:0.5rem 0;padding:0.5rem;border-radius:4px;color:#1a202c;background-color:transparent;-webkit-transition:background-color 0.2s ease-in-out,color 0.2s ease-in-out;transition:background-color 0.2s ease-in-out,color 0.2s ease-in-out;}.css-16tlvlx:hover{background-color:#edf2f7;color:#2d3748;}</style><div class="css-16tlvlx e15bpype2"><style data-emotion="css uq8nah">.css-uq8nah{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;color:inherit;-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-uq8nah e15bpype1" href="/?category=All">All<style data-emotion="css 5a5cp1">.css-5a5cp1{font-size:0.875rem;color:#4a5568;}</style><span class="css-5a5cp1 e15bpype0">(<!-- -->26<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=book">book<span class="css-5a5cp1 e15bpype0">(<!-- -->3<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=fictalk">fictalk<span class="css-5a5cp1 e15bpype0">(<!-- -->1<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=python">python<span class="css-5a5cp1 e15bpype0">(<!-- -->1<!-- -->)</span></a></div><style data-emotion="css bm1ri0">.css-bm1ri0{margin:0.5rem 0;padding:0.5rem;border-radius:4px;color:#ffffff;background-color:#3890ff;-webkit-transition:background-color 0.2s ease-in-out,color 0.2s ease-in-out;transition:background-color 0.2s ease-in-out,color 0.2s ease-in-out;}.css-bm1ri0:hover{background-color:#edf2f7;color:#2776c2;}</style><div class="css-bm1ri0 e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=spring">spring<style data-emotion="css 1vicht9">.css-1vicht9{font-size:0.875rem;color:#ffffff;}</style><span class="css-1vicht9 e15bpype0">(<!-- -->4<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=TIL">TIL<span class="css-5a5cp1 e15bpype0">(<!-- -->15<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=tool">tool<span class="css-5a5cp1 e15bpype0">(<!-- -->2<!-- -->)</span></a></div></nav></div></div></div></div><style data-emotion="css 8k0if6">.css-8k0if6{width:100%;margin:0 auto;max-width:1200px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;overflow-x:auto;}</style><div class="css-8k0if6 e1ijh0y13"><style data-emotion="css q3ydz">.css-q3ydz{min-width:216px;width:216px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}@media (min-width: 768px){.css-q3ydz{display:block;}}@media (max-width: 768px){.css-q3ydz{display:none;}}</style><aside class="css-q3ydz e1ijh0y12"><style data-emotion="css 1fyttco">.css-1fyttco{width:100%;padding:1rem;}</style><nav class="css-1fyttco e15bpype3"><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=All">All<span class="css-5a5cp1 e15bpype0">(<!-- -->26<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=book">book<span class="css-5a5cp1 e15bpype0">(<!-- -->3<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=fictalk">fictalk<span class="css-5a5cp1 e15bpype0">(<!-- -->1<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=python">python<span class="css-5a5cp1 e15bpype0">(<!-- -->1<!-- -->)</span></a></div><div class="css-bm1ri0 e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=spring">spring<span class="css-1vicht9 e15bpype0">(<!-- -->4<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=TIL">TIL<span class="css-5a5cp1 e15bpype0">(<!-- -->15<!-- -->)</span></a></div><div class="css-16tlvlx e15bpype2"><a class="css-uq8nah e15bpype1" href="/?category=tool">tool<span class="css-5a5cp1 e15bpype0">(<!-- -->2<!-- -->)</span></a></div></nav></aside><style data-emotion="css 2ys6mr">.css-2ys6mr{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:100%;padding:1rem;}@media (min-width: 768px){.css-2ys6mr{width:768px;padding:0;}}</style><div class="css-2ys6mr e1ijh0y11"><style data-emotion="css sufrps">.css-sufrps{width:100%;font-size:1rem;line-height:1.6;color:#1a202c;word-break:keep-all;overflow-wrap:break-word;}.css-sufrps img{max-width:100%;height:auto;border-radius:8px;margin:1rem 0;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);}@media (min-width: 768px){.css-sufrps img{border-radius:12px;margin:1.5rem 0;}}.css-sufrps code{background-color:#29323c;padding:0.25rem 0.5rem;border-radius:4px;font-size:0.875rem;font-family:'JetBrains Mono','Fira Code','Consolas',monospace;color:#ffffff;}@media (min-width: 768px){.css-sufrps code{font-size:1rem;}}.css-sufrps pre{background-color:#f8fafc;padding:1rem;border-radius:8px;overflow-x:auto;margin:1rem 0;border:1px solid #e2e8f0;}@media (min-width: 768px){.css-sufrps pre{padding:1.5rem;border-radius:12px;margin:1.5rem 0;}}.css-sufrps pre code{background-color:transparent;padding:0;font-size:0.875rem;line-height:1.6;}@media (min-width: 768px){.css-sufrps pre code{font-size:1rem;line-height:1.7;}}@media (min-width: 768px){.css-sufrps{line-height:1.8;}}.css-sufrps h1,.css-sufrps h2,.css-sufrps h3,.css-sufrps h4,.css-sufrps h5,.css-sufrps h6{margin:2rem 0 1rem;font-weight:700;line-height:1.3;color:#1a202c;}@media (min-width: 768px){.css-sufrps h1,.css-sufrps h2,.css-sufrps h3,.css-sufrps h4,.css-sufrps h5,.css-sufrps h6{margin:2.5rem 0 1.5rem;}}.css-sufrps h1{font-size:2rem;letter-spacing:-0.02em;}@media (min-width: 768px){.css-sufrps h1{font-size:2.5rem;}}.css-sufrps h2{font-size:1.5rem;letter-spacing:-0.01em;}@media (min-width: 768px){.css-sufrps h2{font-size:2rem;}}.css-sufrps h3{font-size:1.25rem;}@media (min-width: 768px){.css-sufrps h3{font-size:1.5rem;}}.css-sufrps p{margin:1rem 0;line-height:1.6;font-size:0.875rem;letter-spacing:-0.003em;}@media (min-width: 768px){.css-sufrps p{margin:1.5rem 0;line-height:1.8;font-size:1rem;}}.css-sufrps a{color:#4a9eff;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;border-bottom:1px solid transparent;}.css-sufrps a:hover{color:#1778ff;border-bottom-color:currentColor;}.css-sufrps a:focus{outline:2px solid #4a9eff;outline-offset:2px;}.css-sufrps ul,.css-sufrps ol{padding-left:1.25rem;margin:1rem 0;}@media (min-width: 768px){.css-sufrps ul,.css-sufrps ol{padding-left:2rem;margin:1.5rem 0;}}.css-sufrps ul ul,.css-sufrps ol ul,.css-sufrps ul ol,.css-sufrps ol ol{margin:0.5rem 0;}@media (min-width: 768px){.css-sufrps ul ul,.css-sufrps ol ul,.css-sufrps ul ol,.css-sufrps ol ol{margin:0.75rem 0;}}.css-sufrps li{margin:0.5rem 0;padding-left:0.25rem;line-height:1.6;}@media (min-width: 768px){.css-sufrps li{margin:0.75rem 0;line-height:1.8;}}.css-sufrps blockquote{margin:1.5rem 0;padding:0.75rem 1rem;border-left:3px solid #4a9eff;background-color:#f8fafc;font-style:italic;color:#4a5568;border-radius:0 8px 8px 0;font-size:0.875rem;}@media (min-width: 768px){.css-sufrps blockquote{margin:2rem 0;padding:1rem 1.5rem;border-left:4px solid #4a9eff;border-radius:0 12px 12px 0;font-size:1rem;}}.css-sufrps blockquote p{margin:0.5rem 0;}@media (min-width: 768px){.css-sufrps blockquote p{margin:0.75rem 0;}}.css-sufrps table{width:100%;border-collapse:separate;border-spacing:0;margin:1.5rem 0;overflow-x:auto;border-radius:8px;border:1px solid #e2e8f0;font-size:0.875rem;-webkit-overflow-scrolling:touch;scrollbar-width:thin;}@media (min-width: 768px){.css-sufrps table{margin:2rem 0;font-size:1rem;border-radius:12px;}}.css-sufrps table::-webkit-scrollbar{height:6px;}.css-sufrps table::-webkit-scrollbar-thumb{background-color:#cbd5e0;border-radius:3px;}.css-sufrps th{background-color:#f8fafc;font-weight:600;white-space:nowrap;padding:0.5rem 0.75rem;}@media (min-width: 768px){.css-sufrps th{padding:0.75rem 1rem;}}.css-sufrps td{padding:0.5rem 0.75rem;word-break:break-word;border:1px solid #e2e8f0;}@media (min-width: 768px){.css-sufrps td{padding:0.75rem 1rem;}}.css-sufrps tr:hover{background-color:#f8fafc;}.css-sufrps hr{border:none;border-top:1px solid #e2e8f0;margin:2rem 0;}@media (min-width: 768px){.css-sufrps hr{border-top:2px solid #e2e8f0;margin:3rem 0;}}</style><div class="markdown-container css-sufrps e1ijh0y10"><h1>Kubernetes에서 Datadog을 사용한 멀티라인 로그 설정</h1>
<p>Kubernetes에서 로그를 처리하는 방법에는 여러 가지가 있습니다:</p>
<ol>
<li>애플리케이션 레벨에서 직접 로그 수집기로 전달하는 구조</li>
<li>사이드카에서 로그를 전달하는 구조</li>
<li>컨테이너의 stdout/stderr을 노드의 파일로 저장한 후, 수집기가 해당 파일을 읽어가는 구조</li>
</ol>
<p>현재 우리는 세 번째 방식을 사용하여 로그를 수집하고 있습니다.
하지만 기본 설정으로는 Datadog에서 Java의 스택 트레이스를 하나의 로그로 인식하지 않습니다.
다른 로그 수집기를 사용하더라도 별도의 설정을 추가하지 않으면 동일한 문제가 발생합니다.
이는 스택 트레이스가 여러 줄로 출력되고, JSON 형태로 저장되기 때문입니다.</p>
<p>스택 트레이스를 여러 개의 로그로 분리하면 비용이 증가할 뿐만 아니라 로그를 분석하는 데에도 불편함이 따릅니다.
따라서 스택 트레이스를 하나의 로그로 합치는 과정이 필요합니다.</p>
<h2>멀티라인 로그 설정</h2>
<p>Datadog에서 스택 트레이스를 하나의 로그로 인식하도록 하려면, 다음과 같이 Deployment의 Pod 템플릿에 애너테이션을 추가해야 합니다</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">ad.datadoghq.com/nginx-service.logs</span><span class="token punctuation">:</span> <span class="token punctuation">></span><span class="token punctuation">-</span>
      <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token key atrule">"source"</span><span class="token punctuation">:</span> <span class="token string">"java"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"service"</span><span class="token punctuation">:</span> <span class="token string">"nginx-service"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"auto_multi_line_detection"</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span>
        <span class="token key atrule">"log_processing_rules"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token key atrule">"type"</span><span class="token punctuation">:</span> <span class="token string">"multi_line"</span><span class="token punctuation">,</span>
            <span class="token key atrule">"name"</span><span class="token punctuation">:</span> <span class="token string">"new_log_start_with_date"</span><span class="token punctuation">,</span>
            <span class="token key atrule">"pattern"</span><span class="token punctuation">:</span> <span class="token string">"\\d{4}-(0?[1-9]|1[012])-(0?[1-9]|[12][0-9]|3[01])"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
~</code></pre></div>
<p>위 설정에서 주목할 부분은 다음과 같습니다</p>
<ul>
<li><code class="language-text">auto_multi_line_detection</code>을 true로 설정하여 Datadog 에이전트가 멀티라인 로그를 자동으로 감지하도록 합니다.</li>
<li><code class="language-text">log_processing_rules</code>에서 multi_line 규칙을 정의합니다. 이 규칙은 새로운 로그의 시작을 날짜 패턴으로 식별합니다.</li>
</ul>
<p>이렇게 설정하면 Datadog 에이전트는 Java 애플리케이션에서 출력되는 스택 트레이스를 하나의 로그로 인식하고 처리할 수 있습니다.</p>
<h2>마무리</h2>
<p>Kubernetes 환경에서 Datadog을 사용할 때, 멀티라인 로그 설정을 추가하면 Java 애플리케이션의 스택 트레이스를 효과적으로 처리할 수 있습니다. 이를 통해 로그 분석을 간편하게 수행할 수 있고, 불필요한 비용 증가를 방지할 수 있습니다. 로그 수집 및 분석은 애플리케이션 운영에 있어 매우 중요한 부분이므로, 적절한 설정을 통해 효율적으로 관리해야 합니다.</p></div></div><style data-emotion="css 116wdba">.css-116wdba{opacity:0;visibility:hidden;display:none;}</style><nav class="css-116wdba etse75s4"><style data-emotion="css 1ayvp3u">.css-1ayvp3u{font-size:1rem;margin-bottom:0.75rem;color:#2d3748;font-weight:600;padding:0.5rem 1rem;}</style><h2 class="css-1ayvp3u etse75s3">목차</h2><style data-emotion="css 1ojlqnt">.css-1ojlqnt{list-style:none;margin:0;overflow-y:auto;max-height:calc(400px - 4rem);border-top:1px solid #e2e8f0;padding-left:1rem;padding-right:1rem;}</style><ul class="css-1ojlqnt etse75s2"></ul></nav></div><style data-emotion="css hx9xpc">@media (max-width: 768px){.css-hx9xpc{padding:0 20px;}}</style><div class="css-hx9xpc e1gqsjds0"></div></main><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx evi8j960">Thank You for Visiting My Blog, Have a Good Day 😆<br/>© 2025 Developer Jung, Powered By Gatsby.</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/spring/k8s-java-datadog-multiline/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-d15ac3e53f49f32106ed.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-36db6f73a4f925d8624b.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-8f9e739c16d1deaf3fb1.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-08fc1cf45523101ace6f.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="c15a83acbd14b5b238e2";</script><script src="/webpack-runtime-8f4c632dbaf3aca48439.js" async></script><script src="/framework-9d608f77b5c9a88afabd.js" async></script><script src="/app-d15ac3e53f49f32106ed.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>